function scrollToLink(e){var t=e.href,i=t.split("#");$("html,body").animate({scrollTop:$("#"+i[1]).offset().top},900)}function getQueryVariable(e){for(var t=window.location.search.substring(1),i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]===e)return n[1]}return!1}function derrickPresentAndLoggedIn(){var e=!1;return"undefined"!=typeof derrick&&derrick.Derrick.prototype.hasProfile()&&(e=!0),e}$(".no-js").removeClass("no-js").addClass("js"),$("body").find("a.scroll").click(function(e){e.preventDefault(),scrollToLink(this)}),function(){function e(e,t,i){this.$form=e,this.$form_wrapper=t||$("body").find("#form-wrapper"),this.$form_container=i||this.$form_wrapper.find("#form-container"),this.$userDetails=this.$form_container.find("#user-details"),this.$questionSection=this.$form_container.find("#question"),this.$inputs=this.$form.find("input"),this.errors=[],this.formID=this.$form.find("#formID").val(),this.$answerLengthFields=this.$form.find(".answer-length")||!1,this.derrickFailed=!1,this._attachEvents(),this.$form.prepend('<input type="hidden" id="js" name="js" value="1" />'),this._addJS()}function t(t,i,r){var n=new e(t,i,r);"function"!=typeof derrickInstance&&(n.derrickFailed=!0),window.competitionForm=n}e.prototype._attachEvents=function(){if(this.$form.on("submit",this._onSubmit.bind(this)),this.$userDetails.on("change","input[type=checkbox], input[type=radio]",this._checkValRemoveError.bind(this)),this.$questionSection.on("change","input[type=checkbox], input[type=radio]",this._checkValRemoveError.bind(this)),this.$questionSection.on("keyup","input, textarea",this._checkValRemoveError.bind(this)),this.$userDetails.on("keyup","input, textarea",this._checkValRemoveError.bind(this)),this.$answerLengthFields){var e=this;this.$answerLengthFields.each(function(){e._initAnswerLength(this)})}},e.prototype._checkValRemoveError=function(e){var t=this.$form.find("#"+e.target.id);t.val().length>0&&this._removeError(t)},e.prototype._onSubmit=function(e){if(derrickPresentAndLoggedIn()||this.derrickFailed){e.preventDefault();var t=this;$.ajax({type:"POST",url:"includes/form.validator.php"+(getQueryVariable("preview")?"?preview="+getQueryVariable("preview"):""),data:this.$form.serialize(),cache:!1,success:function(e){e.length&&t._checkForm(e)}})}},e.prototype._checkForm=function(e){return e=JSON.parse(e),!0===e.submitted?void this._showThankYou():!0===e.fileupload?(this.$form.find("input#js").remove(),void this.$form.submit()):(this._addJS(),this._resetPHP(),this.errors=e,void this._showErrors())},e.prototype._showThankYou=function(){var e=getQueryVariable("preview"),t=this;this.$form_wrapper.width(this.$form_wrapper.outerWidth()).height(this.$form_wrapper.outerHeight()),this.$form_wrapper.append('<div id="result" class="result" />');var i=this.$form_wrapper.find("#result");i.hide(),i.load("includes/templ.success.php?formID="+this.formID+(e?"&preview="+e:""),function(){t.$form_container.fadeOut(1200,function(){$(this).remove(),t.$form_wrapper.addClass("thank-you"),i.fadeIn(1200),$("html, body").animate({scrollTop:t.$form_wrapper.offset().top-70},900)})})},e.prototype._addJS=function(){var e=$("input[name="+j_+"]"),t=this.$inputs.length-1,i=Math.floor(Math.random()*t),r=this.$form.find("input:eq("+i+")");e.length&&e.remove(),$.ajax({type:"GET",url:"includes/inc.js.php",cache:!1,data:{formID:this.formID},success:function(e){e.length&&$('<input type="hidden" name="'+j_+'" value="'+e+'" />').insertBefore(r)}})},e.prototype._resetPHP=function(){$.ajax({type:"GET",url:"includes/inc.reset.php",cache:!1,data:{formID:this.formID},success:function(e){e.length&&$("input[name="+t_+"]").val(e)}})},e.prototype.populateForm=function(e){var t=e.dob.split("-"),i=t[2],r=t[1],n=t[0],s=i>0&&r>0&&n>1900,o="M"===e.gender?"M-Mr":"F-Ms";this._populateAndReplaceField("firstName",e.first_name),this._populateAndReplaceField("surname",e.last_name),this._populateAndReplaceField("email",e.email),this._populateAndReplaceField("postCode",e.postcode),this._populateAndReplaceField("phone",e.phone),this._populateAndReplaceField("dateOfBirth_day",i),this._populateAndReplaceField("dateOfBirth_month",r),this._populateAndReplaceField("dateOfBirth_year",n),this._populateAndReplaceField("gender",o,"select"),e.global_comms&&(this.$form.find('input[name="stationOptIn"]').prop("checked",!0),this.$form.find('input[name="stationOptIn"], label[for="stationOptIn"]').hide()),s&&this.$userDetails.find("#field-container-dateOfBirth").hide()},e.prototype._populateAndReplaceField=function(e,t,i){if(t.length){var r=e+"_inactive",n=e+"_dummy",s="#field-container-"+e,o=this.$userDetails.find('*[name="'+e+'"]');o.hide().attr({name:r,disabled:!0}),$("#"+n).length||($('<span class="dummy" id="'+e+'_dummy">'+t+"</span>").insertBefore(o),$('<input type="hidden" id="'+e+'_substitute" value="'+t+'" name="'+e+'"/>').insertBefore(o)),this.$userDetails.find(s).hide()}},e.prototype._resetField=function(e){var t=this.$userDetails.find("#"+e+"_substitute"),i="#field-container-"+e;t.length?(t.remove(),this.$userDetails.find("#"+e+"_dummy").remove(),this.$userDetails.find('*[name="'+e+'_inactive"]').show().attr({name:e,disabled:!1}),this.$userDetails.find(i).show()):this.$userDetails.find('*[name="'+e+'"]').val("")},e.prototype.clearForm=function(){this._resetField("firstName"),this._resetField("surname"),this._resetField("email"),this._resetField("postCode"),this._resetField("phone"),this._resetField("dateOfBirth_day"),this._resetField("dateOfBirth_month"),this._resetField("dateOfBirth_year"),this._resetField("gender"),this.$userDetails.find("#field-container-dateOfBirth").show()},e.prototype.authenticated=function(e){this.$userDetails.show(),this.populateForm(e),this._triggerSC(e)},e.prototype.notAuthenticated=function(){this.$userDetails.hide(),this.clearForm()},e.prototype.setDerrickFlag=function(e){this.derrickFailed=!1!==e},e.prototype._showErrors=function(){for(var e in this.errors)this.errors.hasOwnProperty(e)&&this.showError(e,this.errors[e]);$("html,body").animate({scrollTop:$(".error").first().offset().top},900)},e.prototype._getErrorElement=function(e){var t=this.$form.find('label[for="'+e+'"]');return t.length||(t=this.$form.find("#"+e)),!!t.length&&t},e.prototype.showError=function(e,t){void 0===t&&(t=this.errors[e]);var i=this._getErrorElement(e);if(!i.length&&"general"!==e)return void console.log("WARNING: can't find parent for "+e);if(2===this.errors.length&&"general"===e&&(this.$form[0].reset(),this._resetPHP()),this.$form.find(".error."+e).length){if(this.$form.find(".error."+e).html()===t)return;this.$form.find(".error."+e).hide("normal").remove()}if("general"===e)return this.$form.find("fieldset").first().prepend('<p class="error '+e+'">'+t+"</p>"),void $("p."+e).hide().show("slow");i.closest(".nested").length&&(i=i.closest(".nested").parent());var r=i.get(0).nodeName.toLowerCase(),n=i.parent(),s=n.get(0).nodeName.toLowerCase(),o=r,a=i;switch(r){case"label":o=s,a=n;break;case"input":"dd"===s&&(s="dt"),o=s,a=n;break;case"dd":i.prev().is("dt")&&(i=i.prev(),o="dt");break;case"ul":case"p":case"dt":case"li":break}var h=document.createElement(o);h.className="error "+e,h.innerHTML=t,$(h).insertBefore(a).hide().show("slow")},e.prototype._removeError=function(e){var t,i=e.attr("id");e.is(":radio")&&(i=e.attr("name")),i.split("_").length>1&&(i=i.split("_")[0]),t=".error."+i,"stationOptIn"!==i&&"clientOptIn"!==i||(t=".error.email, .error.postCode"),this.$form.find(t).hide("normal",function(){$(this).remove()})},e.prototype.removeAllErrors=function(){this.$form.find(".error").hide("normal",function(){$(this).remove()})},e.prototype._initAnswerLength=function(e){var t=$(e),i=$("#"+t.data("target")),r=parseInt(t.find("span").text()),n="words"===t.attr("data-type")?"words":"characters";t.html("<span></span> "+n+" left"),0===i.val().length&&t.find("span").text(r),i.keyup(function(){var e="characters"===n?$(this).val().length:i.val().trim().replace(/\s+/gi," ").split(" ").length,s=r-e,o="";s<0?o="less-than-0":s<30&&(o="less-than-30"),t.addClass(o).find("span").text(s),i.addClass(o).find("span").text(s)})},e.prototype._triggerSC=function(e){var t=[],i="",r=e?"signed_in":"not_signed_in",n="",o=e?e.id:"not_signed_in",a=["prop18","prop46","eVar18","eVar20","prop20","eVar50","events"];if(e.login_event){switch(e.login_event){case"emailRegister":t.push("event3","event9"),i="register";break;case"emailSignIn":t.push("event9"),i="sign_in";break;case"socialSignIn":t.push("event9"),i="sign_in";break}n="MKT:EXT:"+i}s.prop18=r,s.eVar18=r,s.prop46=o,s.eVar50=o,s.eVar20=n,s.eProp20=n,s.events=t.join(","),s.linkTrackVars=a.join(","),s.linkTrackEvents=t.join(","),s.tl(!0,"o","Commercial Microsite")},window.initForm=t}();